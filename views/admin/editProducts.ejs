<%- include('../adminLayouts/header.ejs') %> <%- include('../adminLayouts/sidebar.ejs') %> <%-
include('../adminLayouts/navbar.ejs') %>

<div class="main-panel">
    <div class="content-wrapper">
        <div class="col-12 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <h2 class="card-title">EDIT PRODUCTS</h2>
                    <form
                        class="forms-sample"
                        action=""
                        method="post"
                        enctype="multipart/form-data"
                        onsubmit="return productValiddForm()"
                    >
                        <div class="form-row">
                            <div class="col-md-6 form-group">
                                <label for="exampleInputName1">Product Name</label>
                                <input
                                    type="text"
                                    class="form-control"
                                    id="exampleInputName1"
                                    name="productname"
                                    placeholder="ProductName"
                                    value="<%= data.productname %>"
                                />
                                <p id="productname-error" style="color: red" class="error-message"></p>
                            </div>
                            <div class="col-md-6 form-group">
                                <label for="size">Size</label>
                                <input
                                    type="text"
                                    class="form-control"
                                    id="size"
                                    name="size"
                                    placeholder="Size"
                                    value="<%= data.size %>"
                                />
                                <p id="size-error" style="color: red" class="error-message"></p>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="col-md-4 form-group">
                                <label for="category">Category</label>
                                <select class="form-control" id="category" name="category">
                                    <% Category.forEach(category => { %> <option value="<%= category._id %>" <% if
                                    (category._id === data.categoryId) { %> selected <% } %> > <%= category.categoryname %>
                                    <% }); %>
                                </select>
                            </div>
                            <div class="col-md-4 form-group">
                                <label for="price">Price</label>
                                <input
                                    type="text"
                                    class="form-control"
                                    id="price"
                                    name="price"
                                    placeholder="Price"
                                    value="<%= data.price %>"
                                />
                                <p id="price-error" style="color: red" class="error-message"></p>
                            </div>
                            <div class="col-md-4 form-group">
                                <label for="quantity">Quantity</label>
                                <input
                                    type="text"
                                    class="form-control"
                                    id="quantity"
                                    name="quantity"
                                    placeholder="Quantity"
                                    value="<%= data.quantity %>"
                                />
                                <p id="quantity-error" style="color: red" class="error-message"></p>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="description">Description</label>
                            <textarea class="form-control" id="description" rows="4" name="description">
<%= data.description %></textarea
                            >
                            <p id="description-error" style="color: red" class="error-message"></p>
                        </div>

                        <!-- ... other form fields ... -->
                        <div class="container-fluid">
                            <label for="">File upload (Multiple Images)</label>
                            <div class="row dynamic-image-inputs">
                                <% data.image.forEach((image, index) => { %>
                                <div class="col-md-3 mb-2 existing-image">
                                    <img
                                        src="/static/admin/Assets/images/products/<%= image %>"
                                        style="width: 100px; height: 100px"
                                        alt="Image"
                                        class="product-image"
                                        data-image-name="<%= image %>"
                            
                                    />
                                    <input type="hidden" class="existing-image-input" name="existingImageName" value="<%= image %>" />
                                    <button class="remove-image-btn" data-image="<%= image %>" data-product-id="<%= data._id %>">Remove</button>
                                    <!-- <button class="btn btn-primary change-image-button">Change</button>
                                    <input type="file" class="hidden file-input" name="newImage" accept="image/*" />
                                  -->
                                </div>
                                <% }); %>
                            </div>
                            <div class="col-md-12 mt-2">
                                <button class="btn btn-primary add-image-input" type="button">Add Image</button>
                            </div>
                        </div>

                        <!-- ... rest of the form ... -->

                        <div class="row mt-5">
                            <div class="col-md-12 text-center">
                                <button type="submit" class="btn btn-primary mr-2">Submit</button>
                                <button class="btn btn-dark">Cancel</button>
                            </div>
                        </div>

                        <div class="input-container">
                            <input type="hidden" name="id" value="<%= data._id %>" />
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
        const removeButtons = document.querySelectorAll(".remove-image-btn");

        removeButtons.forEach(button => {
            button.addEventListener("click", async (event) => {
                const productId = event.target.getAttribute("data-product-id");
                const imageName = event.target.getAttribute("data-image");

                try {
                    const response = await fetch(`/admin/delete-image?productId=${productId}&imageName=${imageName}`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                    });

                    if (response.ok) {
                        // Remove the image element from the DOM without reloading the page
                        event.target.parentElement.remove();
                    } else {
                        // Handle error response
                        console.error("Error removing image:", response.statusText);
                    }
                } catch (error) {
                    // Handle network error or JSON parsing error
                    console.error("Error:", error);
                }
            });
        });
    });
</script>

<%- include('../adminLayouts/footer.ejs') %>
