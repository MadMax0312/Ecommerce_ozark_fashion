<%- include('../userLayouts/header.ejs') %> <%- include('../userLayouts/navbar.ejs') %>

<style>
    .text-primary {
        color: #000 !important;
    }
    body {
        width: 98.7vw;
    }
</style>

<div class="site-wrap">
    <div class="site-blocks-cover" style="background-image: url(/static/user/images/hero_1.jpg)" data-aos="fade">
        <div class="container">
            <div class="row align-items-start align-items-md-center justify-content-end">
                <div class="col-md-5 text-center text-md-left pt-5 pt-md-0">
                    <h1 class="mb-2">Finding Your Perfect Shoes</h1>
                    <div class="intro-text text-center text-md-left">
                        <p class="mb-4">
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus at iaculis quam. Integer
                            accumsan tincidunt fringilla.
                        </p>
                        <p>
                            <a href="/shop" class="btn btn-sm btn-primary">Shop Now</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="site-section site-section-sm site-blocks-1">
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-lg-4 d-lg-flex mb-4 mb-lg-0 pl-4" data-aos="fade-up" data-aos-delay="">
                    <div class="icon mr-4 align-self-start">
                        <span class="icon-truck"></span>
                    </div>
                    <div class="text">
                        <h2 class="text-uppercase">Free Shipping</h2>
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus at iaculis quam. Integer
                            accumsan tincidunt fringilla.
                        </p>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4 d-lg-flex mb-4 mb-lg-0 pl-4" data-aos="fade-up" data-aos-delay="100">
                    <div class="icon mr-4 align-self-start">
                        <span class="icon-refresh2"></span>
                    </div>
                    <div class="text">
                        <h2 class="text-uppercase">Free Returns</h2>
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus at iaculis quam. Integer
                            accumsan tincidunt fringilla.
                        </p>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4 d-lg-flex mb-4 mb-lg-0 pl-4" data-aos="fade-up" data-aos-delay="200">
                    <div class="icon mr-4 align-self-start">
                        <span class="icon-help"></span>
                    </div>
                    <div class="text">
                        <h2 class="text-uppercase">Customer Support</h2>
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus at iaculis quam. Integer
                            accumsan tincidunt fringilla.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="site-section site-blocks-2">
        <div class="container">
            <div class="row">
                <div class="col-sm-6 col-md-6 col-lg-4 mb-4 mb-lg-0" data-aos="fade" data-aos-delay="">
                    <a class="block-2-item" href="/shop">
                        <figure class="image">
                            <img src="/static/user/images/women.jpg" alt="" class="img-fluid" />
                        </figure>
                        <div class="text">
                            <span class="text-uppercase">Collections</span>
                            <h3>Women</h3>
                        </div>
                    </a>
                </div>
                <div class="col-sm-6 col-md-6 col-lg-4 mb-5 mb-lg-0" data-aos="fade" data-aos-delay="100">
                    <a class="block-2-item" href="/shop">
                        <figure class="image">
                            <img src="/static/user/images/children.jpg" alt="" class="img-fluid" />
                        </figure>
                        <div class="text">
                            <span class="text-uppercase">Collections</span>
                            <h3>Children</h3>
                        </div>
                    </a>
                </div>
                <div class="col-sm-6 col-md-6 col-lg-4 mb-5 mb-lg-0" data-aos="fade" data-aos-delay="200">
                    <a class="block-2-item" href="/shop">
                        <figure class="image">
                            <img src="/static/user/images/men.jpg" alt="" class="img-fluid" />
                        </figure>
                        <div class="text">
                            <span class="text-uppercase">Collections</span>
                            <h3>Men</h3>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="site-section block-3 site-blocks-2 bg-light">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-7 site-section-heading text-center pt-4">
                    <h2>Featured Products</h2>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                  <div class="nonloop-block-3 owl-carousel">
                    <% if (products.length > 0) { products.reverse().forEach(product => { %>
                        <div class="item">
                            <div class="card">
                                <a href="/product-info?id=<%= product._id %>">
                                    <img
                                        src="/static/admin/Assets/images/products/<%= product.image[0] %>"
                                        alt="Product Image"
                                        class="card-img-top"
                                        style="object-fit: cover; height: 200px"
                                    />
                                </a>
                                <div class="card-body text-center">
                                    <h5 class="card-title" style="margin-bottom: 6px">
                                        <a href="/product-info/id=<%= product._id %>" style="color: black"><%= product.productname %></a>
                                    </h5>
                                    <p class="card-text" style="margin-bottom: 6px"><%= product.description %></p>
                
                                    <% if (product.discountPrice && product.discountPrice > 0) { %>
                                        <p class="card-text text-danger font-weight-bold">
                                            ₹ <%= product.price %> (Actual Price: ₹ <%= product.price - product.discountPrice %>)
                                        </p>
                                    <% } else { %>
                                        <p class="card-text text-primary font-weight-bold">₹ <%= product.price %></p>
                                    <% } %>
                
                                    <div class="d-inline-block">
                                        <button
                                            type="button"
                                            class="btn btn-primary p-1 m-1 addToCartBtn"
                                            data-product-id="<%= product._id %>"
                                        >
                                            Add to Cart
                                        </button>
                                    </div>
                                    <div class="d-inline-block">
                                        <button
                                            type="button"
                                            class="btn p-1 m-1 addToWishlistBtn"
                                            data-product-id="<%= product._id %>"
                                            style="background-color: orange"
                                        >
                                            Add to Wishlist
                                        </button>
                                    </div>
                                    <div class="d-inline-block">
                                        <button
                                            type="button"
                                            class="btn p-1 m-1 buyNowBtn"
                                            data-product-id="<%= product._id %>"
                                            style="background-color: black; color: white"
                                        >
                                            Buy now
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% }); } %>
                </div>
                
                </div>
            </div>
        </div>
    </div>

    <div class="site-section block-8">
        <div class="container">
            <div class="row justify-content-center mb-5">
                <div class="col-md-7 site-section-heading text-center pt-4">
                    <h2>Big Sale!</h2>
                </div>
            </div>
            <div class="row align-items-center">
                <div class="col-md-12 col-lg-7 mb-5">
                    <a href="/shop"
                        ><img src="/static/user/images/blog_1.jpg" alt="Image placeholder" class="img-fluid rounded"
                    /></a>
                </div>
                <div class="col-md-12 col-lg-5 text-center pl-md-5">
                    <h2><a href="#">50% less in all items</a></h2>
                    <p class="post-meta mb-4">
                        By <a href="#">Carl Smith</a> <span class="block-8-sep">&bullet;</span> September 3, 2018
                    </p>
                    <p>
                        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quisquam iste dolor accusantium facere
                        corporis ipsum animi deleniti fugiat. Ex, veniam?
                    </p>
                    <p><a href="/shop" class="btn btn-primary btn-sm">Shop Now</a></p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.body.addEventListener("click", async (event) => {
        if (event.target.matches(".addToCartBtn")) {
            const productId = event.target.getAttribute("data-product-id");
            const quantity = 1;
            console.log(quantity);

            try {
                const response = await fetch("/addToCart", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ id: productId, quantity: 1 }),
                });
                console.log(response);

                const data = await response.json();
                console.log(data);

                if (response.ok) {
                    Swal.fire({
                        icon: "success",
                        title: "Success!",
                        text: data.message,
                    });
                } else {
                    // Check if the response status is 401 (Unauthorized)
                    if (response.status === 401) {
                        Swal.fire({
                            icon: "warning",
                            title: "Warning!",
                            text: "Please log in to continue.",
                            showCancelButton: true,
                            confirmButtonText: "Log In",
                            cancelButtonText: "Cancel",
                        }).then((result) => {
                            if (result.isConfirmed) {
                                // Redirect the user to the login page or handle the login action here
                                window.location.href = "/login";
                            }
                        });
                    } else {
                        // Handle other error cases
                        Swal.fire({
                            icon: "warning",
                            title: "Warning!",
                            text: data.message,
                        });
                    }
                }
            } catch (error) {
                Swal.fire({
                    icon: "error",
                    title: "Error!",
                    text: "An error occurred while adding the product to the cart.",
                });
                console.error("There was a problem with the fetch operation:", error);
            }
        }
    });

    document.body.addEventListener("click", async (event) => {
        if (event.target.matches(".addToWishlistBtn")) {
            const productId = event.target.getAttribute("data-product-id");

            try {
                const response = await fetch("/addToWishlist", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ id: productId }),
                });

                const data = await response.json();

                if (response.ok) {
                    Swal.fire({
                        icon: "success",
                        title: "Success!",
                        text: data.message,
                    });
                } else {
                    // Check if the response status is 401 (Unauthorized)
                    if (response.status === 401) {
                        Swal.fire({
                            icon: "warning",
                            title: "Warning!",
                            text: "Please log in to continue.",
                            showCancelButton: true,
                            confirmButtonText: "Log In",
                            cancelButtonText: "Cancel",
                        }).then((result) => {
                            if (result.isConfirmed) {
                                // Redirect the user to the login page or handle the login action here
                                window.location.href = "/login";
                            }
                        });
                    } else {
                        // Handle other error cases
                        Swal.fire({
                            icon: "warning",
                            title: "Warning!",
                            text: data.message,
                        });
                    }
                }
            } catch (error) {
                Swal.fire({
                    icon: "error",
                    title: "Error!",
                    text: "An error occurred while adding the product to the cart.",
                });
                console.error("There was a problem with the fetch operation:", error);
            }
        }
    });

    document.body.addEventListener("click", async (event) => {
        if (event.target.matches(".buyNowBtn")) {
            const productId = event.target.getAttribute("data-product-id");

            try {
                const response = await fetch(`/checkout?id=${productId}`, {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                    },
                });

                const data = await response.json();

                if (response.ok) {
                    Swal.fire({
                        icon: "success",
                        title: "Success!",
                        text: data.message,
                    });
                } else {
                    // Check if the response status is 401 (Unauthorized)
                    if (response.status === 401) {
                        Swal.fire({
                            icon: "warning",
                            title: "Warning!",
                            text: "Please log in to continue.",
                            showCancelButton: true,
                            confirmButtonText: "Log In",
                            cancelButtonText: "Cancel",
                        }).then((result) => {
                            if (result.isConfirmed) {
                                // Redirect the user to the login page or handle the login action here
                                window.location.href = "/login";
                            }
                        });
                    } else {
                        // Handle other error cases
                        Swal.fire({
                            icon: "warning",
                            title: "Warning!",
                            text: data.message,
                        });
                    }
                }
            } catch (error) {
                Swal.fire({
                    icon: "error",
                    title: "Error!",
                    text: "An error occurred while adding the product to the cart.",
                });
                console.error("There was a problem with the fetch operation:", error);
            }
        }
    });
</script>

<%- include('../userLayouts/footer.ejs') %>
