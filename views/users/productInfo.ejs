<%- include('../userLayouts/header.ejs') %> <%- include('../userLayouts/navbar.ejs') %>

<div class="site-wrap">
    <div class="bg-light py-3">
        <div class="container">
            <div class="row">
                <div class="col-md-12 mb-0">
                    <a href="/">Home</a> <span class="mx-2 mb-0">/</span>
                    <strong class="text-black"><%= Product.productname %></strong>
                </div>
            </div>
        </div>
    </div>

    <div class="site-section">
        <div class="container">
            <div class="row">


               <div class="col-md-6">
    <div id="imageCarousel" class="carousel slide" data-ride="carousel" >
        <div class="carousel-inner">
            <% if (Product && Product.image && Product.image.length > 0) { Product.image.forEach((data, index) => { %>
            <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
                <div class="zoom-container">
                    <img id="myImage" src="/static/admin/Assets/images/products/<%= data %>" class="d-block img-drift-demo-trigger" alt="Image" />
                </div>
          
            </div>
            <% }); } else { %>
            <div class="carousel-item active">
                <div class="zoom-container">
                    <img id="myImage" src="/static/admin/Assets/images/products/<%= data %>" class="d-block img-drift-demo-trigger" alt="Placeholder Image"/>
                </div>
            </div>
            <% } %>
        </div>
        <div class="carousel-controls">
            <a class="carousel-control-prev" href="#imageCarousel" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#imageCarousel" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
    </div>
</div>

                  

                <div class="col-md-6">
                    <h2 class="text-black"><%= Product.productname %></h2>
                    <p><%= Product.description %></p>
                    <p><strong class="text-primary h4">₹<%= Product.price %></strong></p>
                  

                    <div id="wishlistMessage" class="alert" role="alert"></div>

                    <div class="mb-5">
                        <div class="input-group mb-3" style="max-width: 120px">
                            <div class="input-group-prepend">
                                <button class="btn btn-outline-primary js-btn-minus" type="button">&minus;</button>
                            </div>
                            <input
                                type="text"
                                class="form-control text-center"
                                name="quantity"
                                id="quantityInput"
                                value="1"
                                placeholder="1"
                                aria-label="Example text with button addon"
                                aria-describedby="button-addon1"
                            />
                            <div class="input-group-append">
                                <button class="btn btn-outline-primary js-btn-plus" type="button">&plus;</button>
                            </div>
                        </div>
                    </div>

                    <p>
                        <a
                            href="#"
                            class="addToWishlistBtn buy-now btn btn-sm"
                            id="cool"
                            style="color: white; background-color: orange; border-radius: 20px"
                            data-product-id="<%= Product._id %>"
                            >Add to Wishlist</a
                        >
                    </p>

                    <p>
                        <a
                            href="#"
                            class="addToCartBtn buy-now btn btn-sm"
                            id="hot"
                            style="background-color: rgb(52, 186, 47); color: black; border-radius: 20px"
                            data-product-id="<%= Product._id %>"
                        >
                            Add To Cart
                        </a>
                    </p>

                    <p>
                        <a href="/cart" class="buy-now btn btn-sm btn-dark" style="color: white; border-radius: 20px"
                            >Go To Cart</a
                        >
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="site-section block-3 site-blocks-2 bg-light">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-7 site-section-heading text-center pt-4">
                    <h2>Featured Products</h2>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="nonloop-block-3 owl-carousel">
                        <% if (data.length > 0) { for (let i = 0; i < Math.min(data.length, 5); i++) { %>
                        <div class="item">
                            <div class="block-4 text-center">
                                <figure class="block-4-image">
                                    <img
                                        src="/static/admin/Assets/images/products/<%= data[i].image[0] %>"
                                        alt="Image placeholder"
                                        class="img-fluid"
                                    />
                                </figure>
                                <div class="block-4-text p-4">
                                    <h3><a href="#"><%= data[i].productname %></a></h3>
                                    <p class="mb-0">Finding perfect t-shirt</p>
                                    <p class="text-primary font-weight-bold">₹<%= data[i].price %></p>
                                </div>
                            </div>
                        </div>
                        <% } } %>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Move this script block to the end of your HTML body, just before the closing </body> tag -->
<script> 

var clicked = true;


    document.body.addEventListener("click", async (event) => {
        if (event.target.matches(".addToWishlistBtn")) {
            const productId = event.target.getAttribute("data-product-id");
            const messageContainer = document.getElementById("wishlistMessage");

            try {
                const response = await fetch("/addToWishlist?id=" + productId, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ id: productId }),
                });

                const data = await response.json();
                const messageElement = document.createElement("div");
                messageElement.className = "alert";

                if (response.ok) {
                    messageElement.classList.add("alert-success");
                    messageElement.textContent = data.message;
                    alert(data.message)
                } else {
                    messageElement.classList.add("alert-danger");
                    messageElement.textContent =
                        data.message || "An error occurred while adding the product to the wishlist.";
                    alert(data.message)
                }

                messageContainer.appendChild(messageElement);

                setTimeout(() => {
                    messageElement.remove();
                }, 3000);
            } catch (error) {
                const errorMessage = document.createElement("div");
                errorMessage.className = "alert alert-danger";
                errorMessage.textContent = "An error occurred while adding the product to the wishlist.";
                messageContainer.appendChild(errorMessage);

                setTimeout(() => {
                    errorMessage.remove();
                }, 3000);

                console.error("There was a problem with the fetch operation:", error);
            }
        }
    });

    document.body.addEventListener("click", async (event) => {
        if (event.target.matches(".addToCartBtn")) {
            const productId = event.target.getAttribute("data-product-id");
            const quantityInput = document.getElementById("quantityInput");
            const quantity = parseInt(quantityInput.value, 10);

            if (!isNaN(quantity) && quantity > 0) {
                try {
                    const response = await fetch("/addToCart", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({ id: productId, quantity: quantity }),
                    });

                    const data = await response.json();

                    const messageContainer = document.getElementById("wishlistMessage");
                    const messageElement = document.createElement("div");
                    messageElement.className = "alert";

                    if (response.ok) {
                        messageElement.classList.add("alert-success");
                        messageElement.textContent = data.message;
                        alert(data.message)
                    } else {
                        messageElement.classList.add("alert-danger");
                        messageElement.textContent =
                            data.message || "An error occurred while adding the product to the cart.";
                        alert(data.message)
                    }

                    messageContainer.appendChild(messageElement);

                    setTimeout(() => {
                        messageElement.remove();
                    }, 3000);
                } catch (error) {
                    const messageContainer = document.getElementById("wishlistMessage");
                    const errorMessage = document.createElement("div");
                    errorMessage.className = "alert alert-danger";
                    errorMessage.textContent = "An error occurred while adding the product to the cart.";
                    messageContainer.appendChild(errorMessage);

                    setTimeout(() => {
                        errorMessage.remove();
                    }, 3000);

                    console.error("There was a problem with the fetch operation:", error);
                }
            } else {
                console.error("Invalid quantity");
                // Optionally, show an error message to the user
            }
        }
    });
</script>

<%- include('../userLayouts/footer.ejs') %>
